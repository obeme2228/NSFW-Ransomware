title: Multi-Vector Malware Activity Detection
id: 9e7bfe57-2f5b-4c09-9d2f-0a6b4b9e5c61
status: experimental
description: Detects reflective DLL injection, popup ransom note delivery, and XOR-based obfuscation/encryption behaviors on Windows endpoints.
author: Q/AP3X
logsource:
  product: windows
  category: process_creation
detection:
  reflective_dll_injection:
    Image|endswith: '.dll'
    Signed: false
  ransom_note_popup:
    selection1:
      Image|endswith: 'notepad.exe'
      CommandLine|contains: 'readme'
    selection2:
      Image|endswith: 'cmd.exe'
      CommandLine|contains|all:
        - 'echo'
        - 'decrypt'
    selection3:
      Image|endswith: 'powershell.exe'
      CommandLine|contains: 'System.Windows.Forms'
    selection4:
      Image|endswith: 'mshta.exe'
      CommandLine|contains: 'file:///'
  xor_obfuscation:
    selection_ps1:
      Image|endswith: 'powershell.exe'
      CommandLine|contains|all:
        - 'FromBase64String'
        - 'byte[]'
    selection_xor_literal:
      CommandLine|contains: ['xor', '0x']
    selection_caret:
      CommandLine|contains: '^'
  condition: 
    reflective_dll_injection or
    ransom_note_popup.selection1 or ransom_note_popup.selection2 or ransom_note_popup.selection3 or ransom_note_popup.selection4 or
    xor_obfuscation.selection_ps1 or xor_obfuscation.selection_xor_literal or xor_obfuscation.selection_caret
fields:
  - Image
  - CommandLine
  - Signed
  - ParentImage
  - User
level: high
tags:
  - attack.defense_evasion
  - attack.t1055.001
  - ransomware
  - attack.impact
  - obfuscation
  - encryption
  - attack.t1027
